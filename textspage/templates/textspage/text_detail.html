{% extends 'textspage/texts_base.html' %}
{% load static %}

{% block title %}{{ text.title }} | ExdiEngSite{% endblock %}

{% block extra_css %}
    {{ block.super }}
    <link rel="stylesheet" href="{% static 'style/texts_page.css' %}">
    <link rel="stylesheet" href="{% static 'style/text_detail.css' %}">
{% endblock %}

{% block texts_content %}
<div class="main-container">
    <nav class="breadcrumbs">
        <a href="{% url 'home' %}">Home</a> &raquo;
        <a href="{% url 'texts_page' %}">Texts</a> &raquo;
        <span>{{ text.title|truncatechars:30 }}</span>
    </nav>

    <div>
        <div class="text-card">
            <div class="text-card-header">
                <h1 class="text-card-title">{{ text.title }}</h1>
            </div>
            <div class="text-card-body">
                <div class="text-card-content">
                    {{ text.content|linebreaks }}
                </div>
            </div>
        </div>

<div class="text-actions">
    {% if user.is_authenticated %}
        {% if text in user.completed_texts.all %}
            <span class="completed-badge">
                <i class="fas fa-check-circle"></i> Completed
            </span>
        {% else %}
            <form method="post" action="{% url 'complete_text' text.pk %}">
                {% csrf_token %}
                <button type="submit" class="btn-complete">
                    <i class="fas fa-check"></i> Mark as read
                </button>
            </form>
        {% endif %}
    {% endif %}
</div>
    </div>
</div>

<!-- Loading indicator -->
<div class="loading-overlay" id="loading-indicator">
    <div class="loading-spinner"></div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Back to top button
    const backToTopButton = document.getElementById('back-to-top');
    window.addEventListener('scroll', () => {
        if (window.pageYOffset > 300) {
            backToTopButton.style.display = 'block';
        } else {
            backToTopButton.style.display = 'none';
        }
    });

    backToTopButton.addEventListener('click', () => {
        window.scrollTo({ top: 0, behavior: 'smooth' });
    });

    // Loading indicator for links
    document.addEventListener('DOMContentLoaded', function() {
        const links = document.querySelectorAll('a');
        const loadingIndicator = document.getElementById('loading-indicator');

        links.forEach(link => {
            link.addEventListener('click', function(e) {
                if (!link.href || link.getAttribute('target') === '_blank' || link.href.includes('#')) {
                    return;
                }
                loadingIndicator.style.display = 'flex';
            });
        });

        window.addEventListener('load', () => {
            loadingIndicator.style.display = 'none';
        });
    });
</script>
{% endblock %}